<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springlec.springAscent.dao.OrderDao">

	<select id="orderList" resultType="com.springlec.springAscent.dto.OrderDtoOPC">
		SELECT O.ORDERCODE, O.ORDERNUMBER, O.ORDERDATE, C.CARTAMOUNT, O.ORDERAMOUNT, O.ORDERSUM, O.CART_CARTCODE, O.USER_USERID, P.PRODUCTIMAGES, P.PRODUCTNAME, P.PRODUCTSIZE, P.PRODUCTPRICE, C.CARTAMOUNT * P.PRODUCTPRICE AS CARTSUM 
		FROM USERINFO U, CART C, AORDER O, PRODUCT P 
		WHERE O.CART_CARTCODE = C.CARTCODE AND O.USER_USERID = U.USERID AND C.PRODUCT_PRODUCTCODE = P.PRODUCTCODE AND C.USER_USERID = U.USERID AND USERID = #{param1}
		ORDER BY O.ORDERNUMBER
	</select>
	
	<select id="orderWriteView" resultType="com.springlec.springAscent.dto.CartDtoPC" parameterType="java.util.ArrayList">
		SELECT C.CARTCODE, P.PRODUCTCODE, P.PRODUCTIMAGES, P.PRODUCTNAME, P.PRODUCTSIZE, C.CARTAMOUNT, P.PRODUCTPRICE, C.CARTAMOUNT*P.PRODUCTPRICE AS CARTSUM 
		FROM CART C, USERINFO U, PRODUCT P WHERE C.USER_USERID = U.USERID AND C.PRODUCT_PRODUCTCODE = P.PRODUCTCODE AND U.USERID = #{param1} and C.CARTCODE = 
		<foreach collection="#{param2}" item="item" separator=" or ">
		${item}
		</foreach>
	</select>
	
	<insert id="orderWrite">
		INSERT INTO AORDER (USER_USERID, CART_CARTCODE, ORDERSUM, ORDERAMOUNT, ORDERDATE, ORDERRECEIVER, ORDERPOSTCODE, ORDERMAINADDRESS, ORDERDETAILADDRESS, ORDEREXTRAADDRESS, ORDERNUMBER) 
		VALUES (#{param1},#{param2},#{param3},#{param4},NOW(),#{param5},#{param6},#{param7},#{param8},#{param9},#{param10})
	</insert>
	
	<select id="orderDetail" resultType="com.springlec.springAscent.dto.OrderDtoOPC">
		SELECT O.ORDERCODE, O.ORDERDATE, O.ORDERAMOUNT, O.ORDERSUM, O.USER_USERID, O.CART_CARTCODE, P.PRODUCTIMAGES, P.PRODUCTNAME, P.PRODUCTSIZE, P.PRODUCTPRICE, C.CARTAMOUNT 
		FROM AORDER O, CART C, PRODUCT P, USERINFO U
		WHERE O.USER_USERID = U.USERID AND O.CART_CARTCODE = C.CARTCODE AND P.PRODUCTCODE = C.PRODUCT_PRODUCTCODE AND O.ORDERNUMBER = #{param1} AND U.USERID = #{param2}
	</select>
	
</mapper>